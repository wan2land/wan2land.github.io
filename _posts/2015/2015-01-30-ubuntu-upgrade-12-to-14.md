---
layout: post
title: "Ubuntu를 업그레이드 해보자"
date: 2015-01-30 10:42:00 +09:00
tags: ['ubuntu']
---

모든 블로그 정보를 Github으로 이주하고 나니 기존에 블로그를 돌리던 서버가 놀게 되었습니다. 뭐 겸사겸사 이번 기회에 리눅스 공부용으로 제대로 가지고 놀아보려고 합니다. 일단 기존 설치되어있는 버전의 리눅스는 12.04였는데 매번 서버에 접속할때마다 새로운 Ubuntu로 업데이트 하라고 경고가 떴었던 것이 기억났습니다.

```
새 배포판 '14.04.1 LTS'을(를) 사용할 수 있습니다.
업그레이드를 하시려면 'do-release-upgrade' 명령을 실행하세요.
```

사실 그동안은 크게 관심을 두지 않았습니다. 학교에서 리눅스를 처음 배운게 우분투 10.04 였고, 실제로 내가 계속 사용해왔던 것은 12.04 였는데, 그냥 익숙치 않은 버전이었기 때문입니다. 사실, 리눅스 버저닝이 어떻게 되는지 전혀 몰랐었습니다.. 간단히 찾아보니 버전의 첫자리가 릴리즈된 해라는 것! 즉 내가 사용하는건 12년도에 나온 OS를 사용하고 있었던 것입니다. 뭐 기왕 이렇게 된거. 업데이트 해보기로 했습니다 :)

## 시작해보자

시키는 대로 해보았습니다.

```bash
do-release-upgrade
```

뭔가 진행이 되는가 싶더니 경고창이 하나 나왔습니다.

![Alert](/images/dev/ubuntu/ubuntu-upgrade-12-to-14-1.png)

간단히 얘기해서 보통 윈도우 포맷시에는 컴퓨터를 앞에두고 진행을 해서 문제가 생기면 하드웨어를 끄던 리셋을 누르던 할수 있지만 SSH를 통해서 할때는 문제가 발생했을 때(단순히 인터넷이 끊어지더라도) 위험하니 경고메시지를 띄워주는 것입니다. ~~친절한 우분투..~~ 포트번호도 확인했고, 뭐 잘 안되면 서버 리셋시켜버리면 그만이니 그냥 진행하기로. 

그렇게 뭔가 슉슉 진행하던중 대충 이런 메시지가 발생하면서 실패하였습니다. (스샷이 없어 대충 기억나는 메시지로 대체.)

"/boot에 용량이 부족하니 용량을 확보하고 다시 실행해주세요."

## /boot 용량확보

일단 /boot가 뭔지 몰라 대충 찾아보았습니다.. 간단히 얘기해서 커널 이미지를 올리는 디스크라고 합니다. 윈도우에서 포맷할 때 USB든 씨디든지 간에 다른 드라이브로 부팅을 해야 비로소 C드라이브를 삭제할 수 있는 것과 비슷한 원리라고 보면 될것입니다. (트..틀릴수도 있어요..) 그래서 `/boot`라는 녀석에 이미지를 올리고 그 녀석을 통해 이것저것 진행하는 것입니다. 자 대충 알았으니 용량을 확인해보기로 했습니다. 디스크 용량은 `$ df`명령어를 통해 확인할 수 있습니다. 확인을 해보니 저의 경우는 `/boot`사용량이 100%로 나왔습니다. (그냥 가상호스팅 사용하는데 이게 뭔일인지..)

일단 `/boot`내에 삭제할 수 있는 패키지를 확인하기에 앞서 현재 사용중인 커널의 버전을 확인해야합니다. 자칫 잘못 삭제했다가 돌이킬 수 없는 문제가 발생할 수 있기 때문이죠. 최소한 회복할 수 있는 길은 열어두어야 합니다.

```bash
uname -r
# print 3.2.0-23-generic
```

위 명령어를 통해 현재 사용중인 커널의 이미지를 확인할 수 있습니다. 그리고 삭제할 후보들을 뽑아봅시다.

```bash
dpkg -l linux-image*
```

```
+++-====================================-=====================-===========================================
un  linux-image                          <none>                (설명 없음)
un  linux-image-3.0                      <none>                (설명 없음)
ii  linux-image-3.2.0-23-generic         3.2.0-23.36           Linux kernel image for version 3.2.0 on 64 bit x86 SMP
ii  linux-image-3.2.0-74-generic         3.2.0-74.109          Linux kernel image for version 3.2.0 on 64 bit x86 SMP
ii  linux-image-3.2.0-75-generic         3.2.0-75.110          Linux kernel image for version 3.2.0 on 64 bit x86 SMP
ii  linux-image-server                   3.2.0.75.89           Linux kernel image on Server Equipment.
```

여기서 아까 현재 사용중인 커널 이미지를 제외하고 전부 제거하시면 됩니다. (실제로 진행했던 서버에서는 저것 보다 더 많은 내용이 나왔습니다.)

```bash
sudo dpkg --purge linux-image-3.2.0-{74,75}-generic
```

대충 저렇게 명령을 내리시면 됩니다. 그리고 기다리면 깔끔하게 제거가 되고, 이후에 용량을 확인해보면 엄청나게 많은 용량이 확보되어있는 것을 볼 수 있습니다.

이 부분은 더 자세히 보시려면 [해당 링크](https://gist.github.com/jbgo/5016064)를 참조하시면 됩니다.

## 업그레이드 진행

이제 다시 아까 실패했던 명령어를 입력해봅시다.

```bash
do-release-upgrade
```

그리고 몇가지 경고가 뜨고 마찬가지로 잘 진행이 됩니다. 그리고 잘 진행이 됩니다. OS가 업그레이드가 끝나면 내가 설치했었던 패키지들도 업그레이드를 진행하는지 한번 묻습니다. 그때 마다 영어를 잘 읽고 잘 판단하시고 넘어가면 어느세 업그레이드 끝나 있을 것입니다.

그리고 마지막으로 재부팅 한번만 진행하시면!!

![Upgrade Complete](/images/dev/ubuntu/ubuntu-upgrade-12-to-14-2.png)

짠. 하고 14.04 버전이 반겨줄겁니다.

## 참고자료

- <https://gist.github.com/jbgo/5016064>
